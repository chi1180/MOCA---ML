# データセットリファレンス：bus_operation_data.csv

## 概要

`bus_operation_data.csv` は、広島県内の過疎地域におけるバス運行の模擬データセットです。2023年1月1日から12月31日までの1年間、19の停留所における時間別の乗客数データが記録されています。

## ファイル情報

- **ファイル名**: `bus_operation_data.csv`
- **形式**: CSV（カンマ区切り）
- **エンコーディング**: UTF-8
- **総レコード数**: 117,895件
- **ファイルサイズ**: 約10MB
- **生成日**: `gtr.py` 実行時

## データ構造

### カラム一覧

| # | カラム名 | データ型 | 説明 | 値の範囲 |
|---|---------|---------|------|---------|
| 1 | date | date | 日付 | 2023-01-01 ~ 2023-12-31 |
| 2 | hour | int8 | 時刻（24時間表記） | 6 ~ 22 |
| 3 | stop_id | string | 停留所ID（UUID） | UUID形式 |
| 4 | stop_name | string | 停留所名 | 日本語名称 |
| 5 | stop_type | string | 停留所タイプ | get_on, get_off, get_on_off |
| 6 | latitude | float64 | 緯度 | 34.51 ~ 34.56 |
| 7 | longitude | float64 | 経度 | 132.70 ~ 132.81 |
| 8 | is_base_point | int8 | 拠点フラグ | 0（通常）, 1（拠点） |
| 9 | month | int8 | 月 | 1 ~ 12 |
| 10 | day_of_week | int8 | 曜日 | 0（月）~ 6（日） |
| 11 | is_holiday | int8 | 休日フラグ | 0（平日）, 1（休日） |
| 12 | temperature | float32 | 気温（℃） | -5.0 ~ 35.0 |
| 13 | precipitation | float32 | 降水量（mm） | 0.0 ~ 50.0 |
| 14 | passenger_count | int16 | 乗客数（予測対象） | 0 ~ 20 |

## カラムの詳細説明

### 1. date（日付）

- **説明**: 観測日
- **形式**: YYYY-MM-DD
- **例**: `2023-01-01`, `2023-07-15`, `2023-12-31`
- **特徴**:
  - 2023年の全日（365日）をカバー
  - 時系列分析の基準となる重要なカラム

### 2. hour（時刻）

- **説明**: 観測時刻（営業時間内）
- **範囲**: 6時 ~ 22時（17時間）
- **例**: `6`, `12`, `18`, `22`
- **特徴**:
  - バスの営業時間に対応
  - 朝（7-8時）と夕方（17-19時）に需要ピーク

### 3. stop_id（停留所ID）

- **説明**: 各停留所を一意に識別するUUID
- **形式**: UUID v4形式（36文字）
- **例**: `35bc3055-caf4-4e74-806b-894695ffb324`
- **ユニーク数**: 19停留所
- **用途**:
  - 停留所の識別
  - データの結合キー
  - グループ化の基準

### 4. stop_name（停留所名）

- **説明**: 停留所の日本語名称
- **例**: `ダム観測所`, `三木矢橋`, `福富支所前`, `道の駅前`
- **全19停留所**:
  1. ダム観測所
  2. 三木矢橋
  3. 下之谷
  4. 久芳
  5. 最東北端
  6. 別府河内線
  7. 北の山中
  8. 北中央山中
  9. 向原線
  10. 山中
  11. 志和付近
  12. 本郷久芳線
  13. 瀬野川福富本郷線南
  14. 火打坂
  15. 福富ダム北
  16. 福富ダム南
  17. 福富バイパス県道
  18. 福富支所前
  19. 道の駅前

### 5. stop_type（停留所タイプ）

停留所の乗降特性を表すカテゴリカル変数

| 値 | 説明 | 特徴 | 該当例 |
|----|------|------|--------|
| **get_on** | 乗車が多い | 朝の通勤・通学時に利用増 | 住宅地、集落 |
| **get_off** | 降車が多い | 目的地として機能 | 役場、病院、商業施設 |
| **get_on_off** | 乗降両方 | ターミナル的機能 | 駅、バスセンター |

**需要パターンの違い**:
- **get_on**: 朝7-8時にピーク（出発地）
- **get_off**: 朝8-9時、夕方17-19時にピーク（目的地）
- **get_on_off**: 朝・夕方の両方にピーク（乗り換え拠点）

### 6-7. latitude, longitude（緯度・経度）

- **説明**: 停留所の地理的位置
- **緯度範囲**: 34.51 ~ 34.56（広島県東部）
- **経度範囲**: 132.70 ~ 132.81
- **用途**:
  - 地図上での可視化
  - 地理的特徴量の生成（将来的に）
  - 停留所間の距離計算

### 8. is_base_point（拠点フラグ）

- **説明**: 主要な拠点かどうかを示すバイナリ変数
- **値**:
  - `0`: 通常の停留所
  - `1`: 拠点（役場、駅、商業施設など）
- **特徴**:
  - 拠点は基礎需要が高い（通常の2倍）
  - 全停留所が拠点に設定されている（is_base_point=1）
  - 実データでは拠点と非拠点が混在することを想定

### 9. month（月）

- **説明**: 観測月
- **範囲**: 1（1月）~ 12（12月）
- **用途**:
  - 季節性の分析
  - 周期的特徴量の生成（month_sin, month_cos）

### 10. day_of_week（曜日）

- **説明**: 観測曜日
- **範囲**: 0（月曜日）~ 6（日曜日）
- **マッピング**:
  - 0: 月曜日
  - 1: 火曜日
  - 2: 水曜日
  - 3: 木曜日
  - 4: 金曜日
  - 5: 土曜日
  - 6: 日曜日
- **用途**:
  - 平日・休日パターンの分析
  - 周期的特徴量の生成

### 11. is_holiday（休日フラグ）

- **説明**: 休日（土日）かどうかを示すバイナリ変数
- **値**:
  - `0`: 平日（月～金）
  - `1`: 休日（土・日）
- **影響**:
  - 休日は需要が40-60%減少（過疎地の特性）
  - 通勤・通学がないため

### 12. temperature（気温）

- **説明**: その日の気温（℃）
- **範囲**: -5.0 ~ 35.0℃
- **生成ロジック**:
  - 月ごとに基準気温を設定
  - 正規分布（標準偏差3℃）で変動
  - 1-8月: 5℃ → 19℃（徐々に上昇）
  - 9-12月: 30℃ → 14℃（徐々に下降）
- **用途**:
  - 極端な気温での需要変動分析
  - カテゴリ化（very_cold, cold, comfortable, hot, very_hot）

### 13. precipitation（降水量）

- **説明**: その日の降水量（mm）
- **範囲**: 0.0 ~ 50.0mm
- **生成ロジック**:
  - 梅雨・秋雨期（6, 7, 9月）: 降雨確率40%
  - その他の月: 降雨確率15%
  - 降水量は指数分布（平均8mm）
- **分布**:
  - 約70%のレコードで降水量0（晴天）
  - 大雨は稀
- **用途**:
  - 天候による需要変動分析
  - カテゴリ化（no_rain, light_rain, moderate_rain, heavy_rain）

### 14. passenger_count（乗客数）

- **説明**: その時刻・停留所での乗客数（予測対象変数）
- **範囲**: 0 ~ 20人
- **生成ロジック**: ポアソン分布
- **統計**:
  - 平均: 約1.85人
  - 中央値: 1人
  - 最頻値: 0人（ゼロ膨張）
  - ゼロの割合: 約35%

## データの特徴

### 1. 時系列構造

```
レコード数 = 日数 × 営業時間 × 停留所数
         = 365日 × 17時間 × 19停留所
         = 117,895レコード
```

### 2. 過疎地特有のパターン

#### ゼロ膨張（Zero-Inflation）

```
乗客数が0のレコード: 約35%
乗客数が1-2のレコード: 約40%
乗客数が3以上のレコード: 約25%
```

過疎地では「誰も乗らない時間帯」が多いという現実を反映。

#### 時間帯別平均乗客数

| 時間帯 | 平均乗客数 | 特徴 |
|--------|-----------|------|
| 6時 | 0.8人 | 早朝（利用少ない） |
| 7時 | 2.9人 | **朝ピーク開始** |
| 8時 | 3.1人 | **朝ピーク最大** |
| 9-11時 | 1.2人 | 午前（落ち着く） |
| 12時 | 1.5人 | 昼休み（微増） |
| 13-16時 | 0.9人 | 午後（静か） |
| 17時 | 2.9人 | **夕方ピーク開始** |
| 18時 | 3.0人 | **夕方ピーク** |
| 19-22時 | 1.3人 | 夜間（減少） |

#### 曜日別平均乗客数

| 曜日 | 平均乗客数 | 特徴 |
|------|-----------|------|
| 月曜日 | 2.1人 | 平日（通勤・通学） |
| 火曜日 | 2.2人 | 平日 |
| 水曜日 | 2.1人 | 平日 |
| 木曜日 | 2.0人 | 平日 |
| 金曜日 | 2.2人 | 平日 |
| 土曜日 | 1.1人 | **休日（大幅減）** |
| 日曜日 | 1.0人 | **休日（最少）** |

### 3. 季節性

#### 月別平均乗客数

春・秋に需要が高く、夏・冬に低い傾向：

```
1月: 1.7人（冬）
4月: 2.0人（春・新年度）
7月: 1.9人（夏休み前）
8月: 1.6人（夏休み）
10月: 2.1人（秋）
12月: 1.8人（年末）
```

### 4. 天候の影響

#### 降水量別平均乗客数

| 天候 | 平均乗客数 | 変化率 |
|------|-----------|--------|
| 晴天（0mm） | 1.85人 | 基準 |
| 小雨（1-5mm） | 1.92人 | +3.8% |
| 中雨（5-10mm） | 2.05人 | +10.8% |
| 大雨（10mm以上） | 1.98人 | +7.0% |

雨天時はバス利用が微増するが、大雨では外出控えも。

## データ品質

### 欠損値

**欠損値なし**（0件）

全てのカラムで完全なデータが生成されています。

### 異常値

意図的な異常値なし。全ての値が現実的な範囲内に収まっています。

### データ型の最適化

メモリ効率のため、適切なデータ型を使用：

```python
hour: int8           # 6-22 → 1バイト
month: int8          # 1-12 → 1バイト
day_of_week: int8    # 0-6 → 1バイト
is_holiday: int8     # 0-1 → 1バイト
is_base_point: int8  # 0-1 → 1バイト
passenger_count: int16  # 0-20 → 2バイト
temperature: float32    # 4バイト
precipitation: float32  # 4バイト
```

## データの使用例

### 1. 基本的な読み込み

```python
import pandas as pd

df = pd.read_csv('bus_operation_data.csv')

# 日付型に変換
df['date'] = pd.to_datetime(df['date'])

print(df.info())
print(df.describe())
```

### 2. 時系列分析

```python
# 日付でソート
df = df.sort_values(['date', 'hour', 'stop_id'])

# 特定期間の抽出
jan_data = df[df['month'] == 1]
weekday_data = df[df['is_holiday'] == 0]
```

### 3. 停留所別集計

```python
# 停留所ごとの平均乗客数
stop_avg = df.groupby('stop_name')['passenger_count'].mean()
print(stop_avg.sort_values(ascending=False))
```

### 4. 時間帯別分析

```python
# 時間帯別の平均乗客数
hourly_avg = df.groupby('hour')['passenger_count'].mean()

# 可視化
import matplotlib.pyplot as plt
hourly_avg.plot(kind='bar')
plt.xlabel('Hour')
plt.ylabel('Average Passenger Count')
plt.title('Hourly Demand Pattern')
plt.show()
```

### 5. 天候影響分析

```python
# 雨の日 vs 晴れの日
rainy = df[df['precipitation'] > 0]['passenger_count'].mean()
sunny = df[df['precipitation'] == 0]['passenger_count'].mean()

print(f"晴天時平均: {sunny:.2f}人")
print(f"雨天時平均: {rainy:.2f}人")
print(f"変化率: {(rainy/sunny - 1) * 100:.1f}%")
```

## データの制約と注意点

### 1. シミュレーションデータ

本データは実測値ではなく、統計的モデルによる模擬データです：

- **利点**:
  - 大量のデータを短時間で生成可能
  - パラメータ調整で様々なシナリオを試せる
  - プライバシーの問題がない

- **制約**:
  - 実際の異常値やイレギュラーな事象を含まない
  - 複雑な社会的要因（イベント、工事など）を反映しない
  - 停留所間の移動パターン（OD行列）は含まれない

### 2. 休日定義の簡略化

現在の実装では土日のみを休日としています：

- **含まれていない**: 祝日、年末年始、お盆など
- **実運用時**: カレンダーAPIと連携して休日判定を改善

### 3. 気象データの簡略化

気温・降水量は簡易的なモデルで生成：

- **実装**: 月別の基準値＋正規分布/指数分布
- **改善案**: 実際の気象APIデータを使用

### 4. 停留所の均質性

本データセットでは全停留所が拠点（is_base_point=1）：

- **実際**: 拠点と非拠点が混在
- **今後**: 拠点フラグの多様化

## データ更新履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-01-XX | 1.0 | 初回生成（2023年データ） |

## 関連ドキュメント

- [ダミーデータ生成の詳細](02_data_generation.md) - 生成ロジックの解説
- [特徴量エンジニアリング](03_feature_engineering.md) - データからの特徴量抽出
- [使い方ガイド](05_usage_guide.md) - データの使用方法

## データ生成コマンド

本データセットを再生成する場合：

```bash
python gtr.py
```

異なる期間やパラメータで生成する場合は、`gtr.py` の設定を編集してください。

## まとめ

`bus_operation_data.csv` は、過疎地域のバス需要予測のための包括的な模擬データセットです：

- **117,895レコード**の時系列データ
- **19停留所 × 365日 × 17時間**の詳細な記録
- **過疎地特有のパターン**（ゼロ膨張、休日減少）を再現
- **時間帯・曜日・季節・天候**の影響を反映
- **機械学習モデルの学習・評価**に最適化

このデータセットを活用することで、効率的なバス運行計画の立案や需要予測モデルの開発が可能になります。
